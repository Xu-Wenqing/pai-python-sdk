apiVersion: core/v1
metadata:
  provider: 1557702098194904
  identifier: normalize-xflow-ODPS
  version: v1
spec:
  inputs:
    artifacts:
    - name: inputArtifact
      type: {DataSet: {locationType: MaxComputeTable}}
      required: true
      desc: "输入数据"
    - name: provider
      type: {DataSet: {locationType: MaxComputeTable}}
      desc: "配置输入表，即归一化节点生成的参数列表，通过此参数，可以将一张表的配置参数应用到一张新的表"
    parameters:
    - name: __xflowProject
      type: String
      required: true
      value: algo_public
    - name: __execution
      type: Map
      desc: "必选，执行环境"
    - name: outputTableName
      type: String
      desc: "必选，输出表"
    - name: outputParaTableName
      type: String
      desc: "必选，配置输出表"
    - name: lifecycle
      type: Int
      required: true
      value: 28
    - name: selectedColNames
      type: String
      required: true
      desc: "可选，输入表选择列, 默认选中所有列"
    - name: keepOriginal
      desc: "可选，是否保留原始列(keepOriginal =true时，处理过的列重命名;原始列保留，keepOriginal=false时，全部列保留且不重命名)"
      value: false
      type: Bool
    - name: coreNum
      type: Int
      desc: "可选，核心个数"
      value: ""
    - name: memSizePerCore
      type: Int
      desc: "可选，单个核心使用的内存数"
      value: ""
    - name: enableSparse
      type: Bool
      value: false
      desc: "可选，是否打开稀疏支持"
    - name: itemDelimiter
      value: " "
      desc: "可选，kv数据的分隔符"
      type: String
    - name: kvDelimiter
      value: ":"
      desc: "可选，kv数据k，v值的分隔符"
      type: String
    - name: kvIndices
      value: ""
      desc: "可选，kv表中需要归一化的特征索引"
      type: String
  outputs:
    artifacts:
    - name: outputArtifact
      type: {DataSet: {locationType: MaxComputeTable}}
      required: true
      desc: "输出数据"
    - name: outputParaArtifact
      type: {DataSet: {locationType: MaxComputeTable}}
      required: true
      desc: "输出配置表，用于应用到其他的数据集上"
  execution:
    image: "registry.cn-shanghai.aliyuncs.com/kubeflow_demo/kf_odpscmd:studio0.6"
    command:
    - /usr/local/bin/start.sh
    args:
    - |-
     {
      "env": {
        "_PPC_MaxCompute": {{inputs.parameters.__execution}}
      },
      "args": {
        "inputParaTableName|location|table": "{{inputs.artifacts.provider.path}}",
        "__template": "pai_cmd",
        "__dropTables": ["{{inputs.parameters.outputTableName}}","{{inputs.parameters.outputParaTableName}}"],
        "__xflowName": "normalize",
         "__xflowProject": "{{inputs.parameters.__xflowProject}}",
        "outputTableName": "{{inputs.parameters.outputTableName}}",
        "outputParaTableName": "{{inputs.parameters.outputParaTableName}}",
        "lifecycle": "{{inputs.parameters.lifecycle}}",
        "selectedColNames": "{{inputs.parameters.selectedColNames}}",
        "keepOriginal": "{{inputs.parameters.keepOriginal}}",
        "inputTableName|location|table": "{{inputs.artifacts.inputArtifact.path}}",
        "coreNum": "{{inputs.parameters.coreNum}}",
        "memSizePerCore": "{{inputs.parameters.memSizePerCore}}",
        "enableSparse": "{{inputs.parameters.enableSparse}}",
        "itemDelimiter": "{{inputs.parameters.itemDelimiter}}",
        "kvDelimiter": "{{inputs.parameters.kvDelimiter}}",
        "kvIndices": "{{inputs.parameters.kvIndices}}"
       },
      "outputs": {
        "{{outputs.artifacts.outputArtifact.path}}": {"type": "DataSet", "location": {"type": "MaxComputeTable", "table": "{{inputs.parameters.outputTableName}}"}},
        "{{outputs.artifacts.outputParaArtifact.path}}": {"type": "DataSet", "location": {"type": "MaxComputeTable", "table": "{{inputs.parameters.outputParaTableName}}"}}
        }
     }
