apiVersion: core/v1
metadata:
  provider: 1557702098194904
  identifier: type-transform-xflow-ODPS
  version: v1
spec:
  inputs:
    artifacts:
    - name: inputArtifact
      type: {DataSet: {locationType: MaxComputeTable}}
      desc: '可选，切分至输出表1的数据比例'
      required: true
    parameters: #形参
    - name: __xflowProject
      type: String
      required: true
      value: algo_public
    - name: __execution
      type: Map
      desc: "必选，执行环境"
    - name: outputTable
      type: String
      required: true
    - name: reserveOldFeat
      value: false
      type: Bool
      desc: '是否保持原来变换前的数据列'
    - name: cols_to_double
      type: String
      desc: '需要类型转换到double的特征列'
      value: ""
    - name: cols_to_string
      type: String
      desc: '需要类型转换到string的特征列'
      value: ""
    - name: cols_to_int
      type: String
      desc: '需要类型转换到int的特征列'
      value: ""
    - name: default_int_value
      type: Int
      value: 0
      desc: '当特征字段为空时的值'
    - name: default_double_value
      type: Double
      value: 0.0
      desc: '当特征字段为空时的值'
    - name: default_string_value
      type: String
      value: ''
      desc: '当特征字段为空时的值'
    - name: coreNum
      type: Int
      feasible:
        range: '[1,9999]'
      desc: '节点个数'
      value: ""
    - name: memSizePerCore
      type: Int
      value: ""
      feasible:
        range: '[1024,65536]'
      desc: '单个结点内存大小，单位M'
    - name: lifecycle
      type: Int
      value: 28
      desc: '可选，outputTable结果表生命周期'
  outputs:
    parameters:
    - name: test
      type: Int
      value: 22
    artifacts:
    - name: outputArtifact
      type: {DataSet: {locationType: MaxComputeTable}}
      required: true
      desc: '输出表'
  #PAI -name type_transform_v1 -project algo_public -Dlifecycle='28' -DreserveOldFeat='false' -Ddefault_int_value='0' -DoutputTable='pai_temp_83935_1099578_1' -DinputTable='pai_online_project.wumai_data' -Ddefault_double_value='0.0' -Dcols_to_double='time,hour,pm2,pm10,so2,co,no2';
  execution:
    image: "registry.cn-shanghai.aliyuncs.com/kubeflow_demo/kf_odpscmd:studio0.6"
    command:
    - /usr/local/bin/start.sh
    args:
    - |-
      {
       "env": {
         "_PPC_MaxCompute": {{inputs.parameters.__execution}}
       },
       "args": {
         "inputTable|location|table": "{{inputs.artifacts.inputArtifact.path}}",
         "__template": "pai_cmd",
         "__dropTables": ["{{inputs.parameters.outputTable}}"],
         "__xflowName": "type_transform_v1",
         "__xflowProject": "{{inputs.parameters.__xflowProject}}",
         "outputTable": "{{inputs.parameters.outputTable}}",
         "lifecycle": "{{inputs.parameters.lifecycle}}",
         "coreNum": "{{inputs.parameters.coreNum}}",
         "memSizePerCore": "{{inputs.parameters.memSizePerCore}}",
         "reserveOldFeat": "{{inputs.parameters.reserveOldFeat}}",
         "cols_to_double": "{{inputs.parameters.cols_to_double}}",
         "cols_to_string": "{{inputs.parameters.cols_to_string}}",
         "cols_to_int": "{{inputs.parameters.cols_to_int}}",
         "default_int_value": "{{inputs.parameters.default_int_value}}",
         "default_double_value": "{{inputs.parameters.default_double_value}}",
         "default_string_value": "{{inputs.parameters.default_string_value}}"
        },
       "outputs": {
         "{{outputs.artifacts.outputArtifact.path}}": {"type": "DataSet", "location": {"type": "MaxComputeTable", "table": "{{inputs.parameters.outputTable}}"}}
         }
      }