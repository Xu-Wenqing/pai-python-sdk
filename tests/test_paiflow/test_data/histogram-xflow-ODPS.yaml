apiVersion: core/v1
metadata:
  provider: 1557702098194904
  identifier: histogram-xflow-ODPS
  version: v1
spec:
  inputs:
    artifacts:
    - name: inputArtifact
      type: {DataSet: {locationType: MaxComputeTable}}
      required: true
    parameters: #形参
    - name: __xflowProject
      type: String
      required: true
      value: algo_public
    - name: __execution
      type: Map
      desc: "必选，执行环境"
    - name: outputTableName
      type: String
      required: true
    - name: selectedColNames
      type: String
      required: true
      desc: '输入表中用于统计的列名，以逗号分隔，支持int和double类型'
    - name: intervalNum
      type: Int
      value: 100
      feasible:
        range: '(0,INF)'
      desc: '区间个数'
    - name: coreNum
      type: Int
      value: 100
      feasible:
        range: '[1,9999]'
      desc: '节点个数'
    - name: memSizePerCore
      type: Int
      feasible:
        range: '[1024,65536]'
      desc: '单个节点内存大小，单位M'
      value: ""
  outputs:
    artifacts:
    - name: outputArtifact
      type: {DataSet: {locationType: MaxComputeTable}}
      required: true
      desc: '输出表'
  #PAI -name histogram -project algo_public -Dlifecycle='28' -DintervalNum='100' -DselectedColNames='hour,pm10,so2,co,no2,pm2' -DoutputTableName='pai_temp_83935_1099580_1' -DinputTableName='pai_temp_83935_1099578_1';
  execution:
    image: "registry.cn-shanghai.aliyuncs.com/kubeflow_demo/kf_odpscmd:studio0.6"
    command:
    - /usr/local/bin/start.sh
    args:
    - |-
      {
       "env": {
         "_PPC_MaxCompute": {{inputs.parameters.__execution}}
       },
       "args": {
         "inputTableName|location|table": "{{inputs.artifacts.inputArtifact.path}}",
         "__template": "pai_cmd",
         "__dropTables": ["{{inputs.parameters.outputTableName}}"],
         "__xflowName": "histogram",
         "__xflowProject": "{{inputs.parameters.__xflowProject}}",
         "outputTableName": "{{inputs.parameters.outputTableName}}",
         "coreNum": "{{inputs.parameters.coreNum}}",
         "memSizePerCore": "{{inputs.parameters.memSizePerCore}}",
         "selectedColNames": "{{inputs.parameters.selectedColNames}}",
         "intervalNum": "{{inputs.parameters.intervalNum}}"
        },
       "outputs": {
         "{{outputs.artifacts.outputArtifact.path}}": {"type": "DataSet", "location": {"type": "MaxComputeTable", "table": "{{inputs.parameters.outputTableName}}"}}
         }
      }