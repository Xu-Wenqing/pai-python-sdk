apiVersion: core/v1
metadata:
  provider: 1557702098194904
  identifier: split-xflow-ODPS
  version: v1
spec:
  inputs:
    artifacts:
    - name: inputArtifact
      type: {DataSet: {locationType: MaxComputeTable}}
      desc: 'split组件的输入表'
      required: true
    parameters: #形参
    - name: __xflowProject
      type: String
      required: true
      value: algo_public
    - name: __execution
      type: Map
      desc: "必选，执行环境"
    - name: fraction
      type: Double
      value: 0.6
      desc: '可选，切分至输出表1的数据比例'
      feasible:
        range: '(0,1.0)'
    - name: output1TableName
      type: String
      required: true
    - name: output1TablePartition
      type: String
      required: false
      value: ""
    - name: output2TableName
      type: String
      required: true
    - name: output2TablePartition
      type: String
      required: false
      value: ""
    - name: idColName
      type: String
      desc: '可选，ID列（ID相同的数据不会被拆分）'
      required: false
      value: ""
    - name: thresholdColName
      type: String
      desc: '可选，阈值所在列名，不支持String列'
      required: false
      value: ""
    - name: lifecycle
      type: Int
      required: false
      value: ""
      desc: '可选，指定输出表生命周期'
      feasible:
        range: '[1,3650]'
    - name: coreNum
      type: Int
      required: false
      value: ""
      desc: '可选，计算的核心数目'
    - name: memSizePerCore
      type: Int
      value: ""
      required: false
      desc: '可选，每个核心的内存（单位是兆）'
      feasible:
        range: '(1,65536)'
  outputs:
    artifacts:
    - name: outputArtifact1
      type: {DataSet: {locationType: MaxComputeTable}}
    - name: outputArtifact2
      type: {DataSet: {locationType: MaxComputeTable}}
  #PAI -name split -project algo_public -Dlifecycle='28' -Doutput2TableName='pai_temp_83935_1099583_2' -Doutput1TableName='pai_temp_83935_1099583_1' -DinputTableName='pai_temp_83935_1099582_1' -Dfraction='0.8';
  execution:
    image: "registry.cn-shanghai.aliyuncs.com/kubeflow_demo/kf_odpscmd:studio0.6"
    command:
    - /usr/local/bin/start.sh
    args:
    - |-
      {
       "env": {
         "_PPC_MaxCompute": {{inputs.parameters.__execution}}
       },
       "args": {
         "inputTableName|location|table": "{{inputs.artifacts.inputArtifact.path}}",
         "__template": "pai_cmd",
         "__dropTables": ["{{inputs.parameters.output1TableName}}","{{inputs.parameters.output2TableName}}"],
         "__xflowName": "split",
         "__xflowProject": "{{inputs.parameters.__xflowProject}}",
         "fraction": "{{inputs.parameters.fraction}}",
         "output1TableName": "{{inputs.parameters.output1TableName}}",
         "lifecycle": "{{inputs.parameters.lifecycle}}",
         "coreNum": "{{inputs.parameters.coreNum}}",
         "memSizePerCore": "{{inputs.parameters.memSizePerCore}}",
         "output1TablePartition": "{{inputs.parameters.output1TablePartition}}",
         "output2TableName": "{{inputs.parameters.output2TableName}}",
         "output2TablePartition": "{{inputs.parameters.output2TablePartition}}",
         "idColName": "{{inputs.parameters.idColName}}",
         "thresholdColName": "{{inputs.parameters.thresholdColName}}"
        },
       "outputs": {
         "{{outputs.artifacts.outputArtifact1.path}}": {"type": "DataSet", "location": {"type": "MaxComputeTable", "table": "{{inputs.parameters.output1TableName}}", "partition": "{{inputs.parameters.output1TablePartition}}"}},
         "{{outputs.artifacts.outputArtifact2.path}}": {"type": "DataSet", "location": {"type": "MaxComputeTable", "table": "{{inputs.parameters.output2TableName}}", "partition": "{{inputs.parameters.output2TablePartition}}"}}
         }
      }