apiVersion: "core/v1"
metadata:
  provider: "1326689413376250"
  name: null
  version: "v1"
  identifier: "normalize-xflow-maxCompute"
  uuid: "l0s75k2qx48l7vd5of"
  namespace: null
  labels: null
spec:
  inputs:
    artifacts:
    - name: "inputArtifact"
      metadata:
        type:
          DataSet:
            locationType: "MaxComputeTable"
      desc: "输入数据"
      defaultValue: null
      value: null
      from: null
      required: true
    - name: "provider"
      metadata:
        type:
          DataSet:
            locationType: "MaxComputeTable"
      desc: "配置输入表，即归一化节点生成的参数列表，通过此参数，可以将一张表的配置参数应用到一张新的表"
      defaultValue: null
      value: null
      from: null
      required: false
    parameters:
    - name: "__XFlow_project"
      type: "String"
      desc: null
      value: "algo_public"
      resolvedValue: null
      from: null
      path: null
      feasible: null
      required: true
    - name: "__XFlow_execution"
      type: "Map"
      desc: "必选，执行环境"
      value: null
      resolvedValue: null
      from: null
      path: null
      feasible: null
      required: false
    - name: "outputTableName"
      type: "String"
      desc: "必选，输出表"
      value: null
      resolvedValue: null
      from: null
      path: null
      feasible: null
      required: false
    - name: "outputParaTableName"
      type: "String"
      desc: "必选，配置输出表"
      value: null
      resolvedValue: null
      from: null
      path: null
      feasible: null
      required: false
    - name: "lifecycle"
      type: "Int"
      desc: null
      value: 28
      resolvedValue: null
      from: null
      path: null
      feasible: null
      required: true
    - name: "selectedColNames"
      type: "String"
      desc: "可选，输入表选择列, 默认选中所有列"
      value: null
      resolvedValue: null
      from: null
      path: null
      feasible: null
      required: true
    - name: "keepOriginal"
      type: "Bool"
      desc: "可选，是否保留原始列(keepOriginal =true时，处理过的列重命名;原始列保留，keepOriginal=false时，全部列\
        保留且不重命名)"
      value: false
      resolvedValue: null
      from: null
      path: null
      feasible: null
      required: false
    - name: "coreNum"
      type: "Int"
      desc: "可选，核心个数"
      value: ""
      resolvedValue: null
      from: null
      path: null
      feasible: null
      required: false
    - name: "memSizePerCore"
      type: "Int"
      desc: "可选，单个核心使用的内存数"
      value: ""
      resolvedValue: null
      from: null
      path: null
      feasible: null
      required: false
    - name: "enableSparse"
      type: "Bool"
      desc: "可选，是否打开稀疏支持"
      value: false
      resolvedValue: null
      from: null
      path: null
      feasible: null
      required: false
    - name: "itemDelimiter"
      type: "String"
      desc: "可选，kv数据的分隔符"
      value: " "
      resolvedValue: null
      from: null
      path: null
      feasible: null
      required: false
    - name: "kvDelimiter"
      type: "String"
      desc: "可选，kv数据k，v值的分隔符"
      value: ":"
      resolvedValue: null
      from: null
      path: null
      feasible: null
      required: false
    - name: "kvIndices"
      type: "String"
      desc: "可选，kv表中需要归一化的特征索引"
      value: ""
      resolvedValue: null
      from: null
      path: null
      feasible: null
      required: false
  outputs:
    artifacts:
    - name: "outputArtifact"
      metadata:
        type:
          DataSet:
            locationType: "MaxComputeTable"
      desc: "输出数据"
      defaultValue: null
      value: "{\"location\": {\"table\": \"{{inputs.parameters.outputTableName}}\"\
        }}"
      from: null
      required: true
    - name: "outputParaArtifact"
      metadata:
        type:
          DataSet:
            locationType: "MaxComputeTable"
      desc: "输出配置表，用于应用到其他的数据集上"
      defaultValue: null
      value: "{\"location\": {\"table\": \"{{inputs.parameters.outputParaTableName}}\"\
        }}"
      from: null
      required: true
    parameters: []
  arguments:
    artifacts: []
    parameters: []
  dependencies: []
  execution:
    image: "registry.cn-shanghai.aliyuncs.com/paiflow-core/max-compute-executor:1.0.0"
    command:
    - "python"
    - "-c"
    - "import json\nimport os\nfrom executor import execute\nfrom utils import read_file,\
      \ get_json_value\nimport sys\n\nargs = '''{\n     \"__XFlow_execution\": {{inputs.parameters.__XFlow_execution}},\n\
      \   \"__XFlow_template\": \"pai_cmd\",\n   \"__XFlow_dropTables\": [\"{{inputs.parameters.outputTableName}}\"\
      ,\"{{inputs.parameters.outputParaTableName}}\"],\n   \"__XFlow_name\": \"normalize\"\
      ,\n   \"__XFlow_project\": \"{{inputs.parameters.__XFlow_project}}\",\n   \"\
      outputTableName\": \"{{inputs.parameters.outputTableName}}\",\n   \"outputParaTableName\"\
      : \"{{inputs.parameters.outputParaTableName}}\",\n   \"lifecycle\": \"{{inputs.parameters.lifecycle}}\"\
      ,\n   \"selectedColNames\": \"{{inputs.parameters.selectedColNames}}\",\n  \
      \ \"keepOriginal\": \"{{inputs.parameters.keepOriginal}}\",\n   \"coreNum\"\
      : \"{{inputs.parameters.coreNum}}\",\n   \"memSizePerCore\": \"{{inputs.parameters.memSizePerCore}}\"\
      ,\n   \"enableSparse\": \"{{inputs.parameters.enableSparse}}\",\n   \"itemDelimiter\"\
      : \"{{inputs.parameters.itemDelimiter}}\",\n   \"kvDelimiter\": \"{{inputs.parameters.kvDelimiter}}\"\
      ,\n   \"kvIndices\": \"{{inputs.parameters.kvIndices}}\"\n}'''\n\nresolved_args\
      \ = json.loads(args)\ncontent = read_file('{{inputs.artifacts.provider.path}}')\n\
      if len(content.strip()) != 0:\n    data = json.loads(content)\n    resolved_args['inputParaTableName']\
      \ = get_json_value(data, '{{ data.location.table }}')\n\ndata = json.loads(read_file('{{inputs.artifacts.inputArtifact.path}}'))\n\
      resolved_args['inputTableName'] = get_json_value(data, '{{ data.location.table\
      \ }}')\nexit_code = execute(resolved_args)\nsys.exit(exit_code)"
    args: null
  pipelines: []