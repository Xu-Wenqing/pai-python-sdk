apiVersion: core/v1
metadata:
  identifier: ut-air-quality
  provider: 1557702098194904
  version: v1.0.0
spec:
  inputs:
    parameters:
    - name: execution
      required: true
      type: Map
    - name: cols_to_double
      required: true
      type: String
    - name: histogram_selected_col_names
      required: true
      type: String
    - name: sql
      required: true
      type: String
    - name: normalize_selected_col_names
      required: true
      type: String
    - name: fraction
      required: true
      type: Double
    - name: randomforest_feature_col_names
      required: true
      type: String
    - name: randomforest_label_col_names
      required: true
      type: String
    - name: prediction1_feature_col_names
      required: true
      type: String
    - name: prediction1_append_col_names
      required: true
      type: String
    - name: prediction1_result_col_names
      required: true
      type: String
    - name: prediction1_score_col_names
      required: true
      type: String
    - name: prediction1_detail_col_names
      required: true
      type: String
    - name: evaluate1_label_col_name
      required: true
      type: String
    - name: evaluate1_score_col_name
      required: true
      type: String
    - name: evaluate1_positive_label
      required: true
      type: String
    - name: evaluate1_bin_count
      required: true
      type: Int
    - name: logisticregression_feature_col_names
      required: true
      type: String
    - name: logisticregression_label_col_names
      required: true
      type: String
    - name: logisticregression_good_value
      required: true
      type: Int
    - name: prediction2_feature_col_names
      required: true
      type: String
    - name: prediction2_append_col_names
      required: true
      type: String
    - name: prediction2_result_col_names
      required: true
      type: String
    - name: prediction2_score_col_names
      required: true
      type: String
    - name: prediction2_detail_col_names
      required: true
      type: String
    - name: evaluate2_label_col_name
      required: true
      type: String
    - name: evaluate2_score_col_name
      required: true
      type: String
    - name: evaluate2_positive_label
      required: true
      type: String
    - name: evaluate2_bin_count
      required: true
      type: Int
  outputs:
    artifacts:
    - from: '{{pipelines.evaluate2.outputs.artifacts.outputDetailArtifact}}'
      name: predictionResult
      type:
        ModelEvaluation:
          locationType: MaxComputeTable
  pipelines:
  - metadata:
      annotations: null
      identifier: odps-data-source
      labels: null
      name: dataSource
      namespace: null
      provider: '1557702098194904'
      uuid: iryzwnxi8l4l9dfur1
      version: v1
    spec:
      arguments:
        parameters:
        - name: tableName
          value: pai_online_project.wumai_data
        - from: '{{inputs.parameters.execution}}'
          name: __execution
  - metadata:
      annotations: null
      identifier: type-transform-xflow-ODPS
      labels: null
      name: typeTransform
      namespace: null
      provider: '1557702098194904'
      uuid: 0a6warbzbbr4ptinw9
      version: v1
    spec:
      arguments:
        artifacts:
        - from: '{{pipelines.dataSource.outputs.artifacts.outputArtifact}}'
          name: inputArtifact
        parameters:
        - from: '{{inputs.parameters.execution}}'
          name: __execution
        - name: outputTable
          value: type-transform-xflow-ODPS
        - from: '{{inputs.parameters.cols_to_double}}'
          name: cols_to_double
      dependencies:
      - dataSource
  - metadata:
      annotations: null
      identifier: histogram-xflow-ODPS
      labels: null
      name: histogram
      namespace: null
      provider: '1557702098194904'
      uuid: f0s3m94pibfq36bwbr
      version: v1
    spec:
      arguments:
        artifacts:
        - from: '{{pipelines.typeTransform.outputs.artifacts.outputArtifact}}'
          name: inputArtifact
        parameters:
        - from: '{{inputs.parameters.execution}}'
          name: __execution
        - name: outputTableName
          value: pai_temp_172808_1779985_1
        - from: '{{inputs.parameters.histogram_selected_col_names}}'
          name: selectedColNames
      dependencies:
      - typeTransform
  - metadata:
      annotations: null
      identifier: sql-xflow-ODPS
      labels: null
      name: sql
      namespace: null
      provider: '1557702098194904'
      uuid: plai1sxzl2b2l1c22f
      version: v1
    spec:
      arguments:
        artifacts:
        - from: '{{pipelines.typeTransform.outputs.artifacts.outputArtifact}}'
          name: inputArtifact1
        parameters:
        - from: '{{inputs.parameters.execution}}'
          name: __execution
        - name: outputTable
          value: pai_temp_83935_1099579_1
        - from: '{{inputs.parameters.sql}}'
          name: sql
      dependencies:
      - typeTransform
  - metadata:
      annotations: null
      identifier: fe-meta-runner-xflow-ODPS
      labels: null
      name: feMetaRunner
      namespace: null
      provider: '1557702098194904'
      uuid: stnbaom1nrso3upmxx
      version: v1
    spec:
      arguments:
        artifacts:
        - from: '{{pipelines.sql.outputs.artifacts.outputArtifact}}'
          name: inputArtifact
        parameters:
        - from: '{{inputs.parameters.execution}}'
          name: __execution
        - name: outputTable
          value: pai_temp_83935_1099581_1
        - name: mapTable
          value: pai_temp_83935_1099581_2
        - name: selectedCols
          value: pm10,so2,co,no2
        - name: labelCol
          value: _c2
      dependencies:
      - sql
  - metadata:
      annotations: null
      identifier: normalize-xflow-ODPS
      labels: null
      name: normalize
      namespace: null
      provider: '1557702098194904'
      uuid: uv613vxkxa94a2ekq3
      version: v1
    spec:
      arguments:
        artifacts:
        - from: '{{pipelines.sql.outputs.artifacts.outputArtifact}}'
          name: inputArtifact
        parameters:
        - from: '{{inputs.parameters.execution}}'
          name: __execution
        - name: outputTableName
          value: pai_temp_83935_1099582_1
        - name: outputParaTableName
          value: pai_temp_83935_1099582_2
        - from: '{{inputs.parameters.normalize_selected_col_names}}'
          name: selectedColNames
      dependencies:
      - sql
  - metadata:
      annotations: null
      identifier: split-xflow-ODPS
      labels: null
      name: split
      namespace: null
      provider: '1557702098194904'
      uuid: m3o458h6gmwu8www39
      version: v1
    spec:
      arguments:
        artifacts:
        - from: '{{pipelines.normalize.outputs.artifacts.outputArtifact}}'
          name: inputArtifact
        parameters:
        - from: '{{inputs.parameters.execution}}'
          name: __execution
        - from: '{{inputs.parameters.fraction}}'
          name: fraction
        - name: output1TableName
          value: pai_temp_83935_1099583_1
        - name: output2TableName
          value: pai_temp_83935_1199583_1
      dependencies:
      - normalize
  - metadata:
      annotations: null
      identifier: randomforests-xflow-ODPS
      labels: null
      name: randomforests
      namespace: null
      provider: '1557702098194904'
      uuid: 6ysvoik9zwvrq3svoz
      version: v1
    spec:
      arguments:
        artifacts:
        - from: '{{pipelines.split.outputs.artifacts.outputArtifact1}}'
          name: inputArtifact
        parameters:
        - from: '{{inputs.parameters.execution}}'
          name: __execution
        - from: '{{inputs.parameters.randomforest_label_col_names}}'
          name: labelColName
        - name: modelName
          value: xlab_m_random_forests_1099584_v0
        - name: treeNum
          value: 100
        - from: '{{inputs.parameters.randomforest_feature_col_names}}'
          name: featureColNames
        - name: __generatePMML
          value: true
        - name: __pmmlModelPublicProject
          value: pai_online_project
        - name: __pmmlModelPublicEndpoint
          value: http://service.cn-shanghai.maxcompute.aliyun.com/api
        - name: __pmmlModelVolume
          value: pai_model_1557702098194904
        - name: __pmmlModelPartition
          value: partition_1099584
      dependencies:
      - split
  - metadata:
      annotations: null
      identifier: prediction-xflow-ODPS
      labels: null
      name: prediction1
      namespace: null
      provider: '1557702098194904'
      uuid: cipbpo6ps5pjevgcj5
      version: v1
    spec:
      arguments:
        artifacts:
        - from: '{{pipelines.split.outputs.artifacts.outputArtifact2}}'
          name: inputDataSetArtifact
        - from: '{{pipelines.randomforests.outputs.artifacts.outputArtifact}}'
          name: inputModelArtifact
        parameters:
        - from: '{{inputs.parameters.execution}}'
          name: __execution
        - name: outputTableName
          value: pai_temp_83935_1029583_1
        - from: '{{inputs.parameters.prediction1_feature_col_names}}'
          name: featureColNames
        - from: '{{inputs.parameters.prediction1_append_col_names}}'
          name: appendColNames
        - from: '{{inputs.parameters.prediction1_result_col_names}}'
          name: resultColName
        - from: '{{inputs.parameters.prediction1_score_col_names}}'
          name: scoreColName
        - from: '{{inputs.parameters.prediction1_detail_col_names}}'
          name: detailColName
      dependencies:
      - randomforests
      - split
  - metadata:
      annotations: null
      identifier: evaluate-xflow-ODPS
      labels: null
      name: evaluate1
      namespace: null
      provider: '1557702098194904'
      uuid: dp8hf70018coam5c2r
      version: v1
    spec:
      arguments:
        artifacts:
        - from: '{{pipelines.prediction1.outputs.artifacts.outputArtifact}}'
          name: inputArtifact
        parameters:
        - from: '{{inputs.parameters.execution}}'
          name: __execution
        - name: outputDetailTableName
          value: pai_temp_83935_1099586_1
        - name: outputELDetailTableName
          value: pai_temp_83935_1299589_1
        - name: outputMetricTableName
          value: pai_temp_83935_1228529_1
        - from: '{{inputs.parameters.evaluate1_positive_label}}'
          name: positiveLabel
        - from: '{{inputs.parameters.evaluate1_bin_count}}'
          name: binCount
        - from: '{{inputs.parameters.evaluate1_score_col_name}}'
          name: scoreColName
        - from: '{{inputs.parameters.evaluate1_label_col_name}}'
          name: labelColName
      dependencies:
      - prediction1
  - metadata:
      annotations: null
      identifier: logisticregression-binary-xflow-ODPS
      labels: null
      name: logisticregression
      namespace: null
      provider: '1557702098194904'
      uuid: e37ku9kxqub2ade5wp
      version: v1
    spec:
      arguments:
        artifacts:
        - from: '{{pipelines.split.outputs.artifacts.outputArtifact1}}'
          name: inputArtifact
        parameters:
        - from: '{{inputs.parameters.execution}}'
          name: __execution
        - from: '{{inputs.parameters.logisticregression_label_col_names}}'
          name: labelColName
        - from: '{{inputs.parameters.logisticregression_feature_col_names}}'
          name: featureColNames
        - name: __generatePMML
          value: true
        - name: modelName
          value: xlab_m_logisticregres_1099587_v0
        - from: '{{inputs.parameters.logisticregression_good_value}}'
          name: goodValue
        - name: __pmmlModelPublicProject
          value: pai_online_project
        - name: __pmmlModelPublicEndpoint
          value: http://service.cn-shanghai.maxcompute.aliyun.com/api
        - name: __pmmlModelVolume
          value: pai_model_1557702098194904
        - name: __pmmlModelPartition
          value: partition_1099587
      dependencies:
      - split
  - metadata:
      annotations: null
      identifier: prediction-xflow-ODPS
      labels: null
      name: prediction2
      namespace: null
      provider: '1557702098194904'
      uuid: cipbpo6ps5pjevgcj5
      version: v1
    spec:
      arguments:
        artifacts:
        - from: '{{pipelines.split.outputs.artifacts.outputArtifact2}}'
          name: inputDataSetArtifact
        - from: '{{pipelines.logisticregression.outputs.artifacts.outputArtifact}}'
          name: inputModelArtifact
        parameters:
        - from: '{{inputs.parameters.execution}}'
          name: __execution
        - name: outputTableName
          value: pai_temp_83935_1099588_1
        - from: '{{inputs.parameters.prediction2_feature_col_names}}'
          name: featureColNames
        - from: '{{inputs.parameters.prediction2_append_col_names}}'
          name: appendColNames
        - from: '{{inputs.parameters.prediction2_result_col_names}}'
          name: resultColName
        - from: '{{inputs.parameters.prediction2_score_col_names}}'
          name: scoreColName
        - from: '{{inputs.parameters.prediction2_detail_col_names}}'
          name: detailColName
      dependencies:
      - logisticregression
      - split
  - metadata:
      annotations: null
      identifier: evaluate-xflow-ODPS
      labels: null
      name: evaluate2
      namespace: null
      provider: '1557702098194904'
      uuid: dp8hf70018coam5c2r
      version: v1
    spec:
      arguments:
        artifacts:
        - from: '{{pipelines.prediction2.outputs.artifacts.outputArtifact}}'
          name: inputArtifact
        parameters:
        - from: '{{inputs.parameters.execution}}'
          name: __execution
        - name: outputDetailTableName
          value: pai_temp_83935_1099589_1
        - name: outputELDetailTableName
          value: pai_temp_83935_1199589_1
        - name: outputMetricTableName
          value: pai_temp_83935_1428529_1
        - from: '{{inputs.parameters.evaluate2_positive_label}}'
          name: positiveLabel
        - from: '{{inputs.parameters.evaluate2_bin_count}}'
          name: binCount
        - from: '{{inputs.parameters.evaluate2_score_col_name}}'
          name: scoreColName
        - from: '{{inputs.parameters.evaluate2_label_col_name}}'
          name: labelColName
      dependencies:
      - prediction2
